<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="974px" preserveAspectRatio="none" style="width:527px;height:974px;background:#FFFFFF;" version="1.1" viewBox="0 0 527 974" width="527px" zoomAndPan="magnify"><defs/><g><ellipse cx="127" cy="20" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1.0;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="68" x="93" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="48" x="103" y="71.1387">程序启动</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="140" x="57" y="103.9688"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="120" x="67" y="125.1074">连接Wayland Server</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="185" x="34.5" y="157.9375"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="165" x="44.5" y="179.0762">绑定ID 1的Object wl_display</text><path d="M254.5,201.9063 L254.5,225.6055 L234.5,229.6055 L254.5,233.6055 L254.5,257.3047 A0,0 0 0 0 254.5,257.3047 L515.5,257.3047 A0,0 0 0 0 515.5,257.3047 L515.5,211.9063 L505.5,201.9063 L254.5,201.9063 A0,0 0 0 0 254.5,201.9063 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M505.5,201.9063 L505.5,211.9063 L515.5,211.9063 L505.5,201.9063 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="260.5" y="218.9731">Wayland Server收到get_registry请求后</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="260.5" y="234.106">会通过wl_registry的global事件</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="260.5" y="249.2388">通知客户端所有可用的全局Object</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="215" x="19.5" y="212.6211"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="195" x="29.5" y="233.7598">向wl_display发送get_registry请求</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="169" x="42.5" y="277.3047"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="149" x="52.5" y="298.4434">向wl_display发送sync请求</text><path d="M195.5,328.125 L195.5,344.2578 L175.5,348.2578 L195.5,352.2578 L195.5,368.3906 A0,0 0 0 0 195.5,368.3906 L485.5,368.3906 A0,0 0 0 0 485.5,368.3906 L485.5,338.125 L475.5,328.125 L195.5,328.125 A0,0 0 0 0 195.5,328.125 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M475.5,328.125 L475.5,338.125 L485.5,338.125 L475.5,328.125 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269" x="201.5" y="345.1919">期间可以通过wl_registry_add_listener注册的</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="201.5" y="360.3247">listener函数bind需要的全局Object</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="97" x="78.5" y="331.2734"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="77" x="88.5" y="352.4121">等待Sync完成</text><rect fill="#F1F1F1" height="47.9375" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="232" x="11" y="388.3906"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="212" x="21" y="409.5293">通过wl_compositor_create_surface</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="71" x="21" y="423.498">创建surface</text><rect fill="#F1F1F1" height="47.9375" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="206" x="24" y="456.3281"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="186" x="34" y="477.4668">通过wl_shell_get_shell_surface</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="177" x="34" y="491.4355">从surface中得到shell_surface</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="222" x="16" y="524.2656"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="202" x="26" y="545.4043">设置shell_surface的属性为顶级窗口</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="164" x="45" y="578.2344"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="144" x="55" y="599.373">通过系统调用设置共享内存</text><rect fill="#F1F1F1" height="47.9375" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="184" x="35" y="632.2031"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="160" x="45" y="653.3418">通过wl_shm_create_pool将</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="164" x="45" y="667.3105">共享内存注册到wl_shm对象中</text><rect fill="#F1F1F1" height="47.9375" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="211" x="21.5" y="700.1406"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="191" x="31.5" y="721.2793">通过wl_shm_pool_create_buffer</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="171" x="31.5" y="735.248">从wl_shm对象中得到wl_buffer</text><rect fill="#F1F1F1" height="47.9375" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="180" x="37" y="768.0781"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="160" x="47" y="789.2168">通过wl_surface_attach绑定</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="132" x="47" y="803.1855">wl_surface和wl_buffer</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="184" x="35" y="836.0156"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="164" x="45" y="857.1543">wl_surface_commit提交上屏</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="189" x="32.5" y="889.9844"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="169" x="42.5" y="911.123">wl_display_dispatch事件循环</text><ellipse cx="127" cy="953.9531" fill="none" rx="10" ry="10" style="stroke:#222222;stroke-width:1.5;"/><line style="stroke:#222222;stroke-width:2.5;" x1="120.8128" x2="133.1872" y1="947.7659" y2="960.1403"/><line style="stroke:#222222;stroke-width:2.5;" x1="133.1872" x2="120.8128" y1="947.7659" y2="960.1403"/><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="127" y1="30" y2="50"/><polygon fill="#181818" points="123,40,127,50,131,40,127,44" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="127" y1="83.9688" y2="103.9688"/><polygon fill="#181818" points="123,93.9688,127,103.9688,131,93.9688,127,97.9688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="127" y1="137.9375" y2="157.9375"/><polygon fill="#181818" points="123,147.9375,127,157.9375,131,147.9375,127,151.9375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="127" y1="191.9063" y2="212.6211"/><polygon fill="#181818" points="123,202.6211,127,212.6211,131,202.6211,127,206.6211" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="127" y1="246.5898" y2="277.3047"/><polygon fill="#181818" points="123,267.3047,127,277.3047,131,267.3047,127,271.3047" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="127" y1="311.2734" y2="331.2734"/><polygon fill="#181818" points="123,321.2734,127,331.2734,131,321.2734,127,325.2734" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="127" y1="365.2422" y2="388.3906"/><polygon fill="#181818" points="123,378.3906,127,388.3906,131,378.3906,127,382.3906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="127" y1="436.3281" y2="456.3281"/><polygon fill="#181818" points="123,446.3281,127,456.3281,131,446.3281,127,450.3281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="127" y1="504.2656" y2="524.2656"/><polygon fill="#181818" points="123,514.2656,127,524.2656,131,514.2656,127,518.2656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="127" y1="558.2344" y2="578.2344"/><polygon fill="#181818" points="123,568.2344,127,578.2344,131,568.2344,127,572.2344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="127" y1="612.2031" y2="632.2031"/><polygon fill="#181818" points="123,622.2031,127,632.2031,131,622.2031,127,626.2031" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="127" y1="680.1406" y2="700.1406"/><polygon fill="#181818" points="123,690.1406,127,700.1406,131,690.1406,127,694.1406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="127" y1="748.0781" y2="768.0781"/><polygon fill="#181818" points="123,758.0781,127,768.0781,131,758.0781,127,762.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="127" y1="816.0156" y2="836.0156"/><polygon fill="#181818" points="123,826.0156,127,836.0156,131,826.0156,127,830.0156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="127" y1="869.9844" y2="889.9844"/><polygon fill="#181818" points="123,879.9844,127,889.9844,131,879.9844,127,883.9844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="127" y1="923.9531" y2="943.9531"/><polygon fill="#181818" points="123,933.9531,127,943.9531,131,933.9531,127,937.9531" style="stroke:#181818;stroke-width:1.0;"/><!--MD5=[4b1e439d005aef9334b1a8cfb0876f97]
@startuml
start
:程序启动;
:连接Wayland Server;
:绑定ID 1的Object wl_display;
:向wl_display发送get_registry请求;
note right
Wayland Server收到get_registry请求后
会通过wl_registry的global事件
通知客户端所有可用的全局Object
end note
:向wl_display发送sync请求;
:等待Sync完成;
note right
期间可以通过wl_registry_add_listener注册的
listener函数bind需要的全局Object
end note
:通过wl_compositor_create_surface
创建surface;
:通过wl_shell_get_shell_surface
从surface中得到shell_surface;
:设置shell_surface的属性为顶级窗口;
:通过系统调用设置共享内存;
:通过wl_shm_create_pool将
共享内存注册到wl_shm对象中;
:通过wl_shm_pool_create_buffer
从wl_shm对象中得到wl_buffer;
:通过wl_surface_attach绑定
wl_surface和wl_buffer;
:wl_surface_commit提交上屏;
:wl_display_dispatch事件循环;
end
@enduml

PlantUML version 1.2022.7(Mon Aug 22 17:01:30 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>